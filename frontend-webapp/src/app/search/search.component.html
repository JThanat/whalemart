<ng-container *appSubNavBar>
  <form class="filter-bar" [formGroup]="searchFilterForm">
    <app-menu text="ช่วงราคา">
      <div class="p-5">ช่วงราคา</div>
    </app-menu>
    <app-menu text="วันจัดตลาด">
      <div class="p-5">วันจัดตลาด</div>
    </app-menu>
    <app-menu text="ช่วงเวลาที่ตลาดเปิด">
      <div class="my-3 mx-4" formGroupName="time">
        <div class="form-check">
          <label class="form-check-label">
            <input type="checkbox" formControlName="morning" class="form-check-input">
            เช้า
          </label>
        </div>
        <div class="form-check">
          <label class="form-check-label">
            <input type="checkbox" formControlName="afternoon" class="form-check-input">
            บ่าย
          </label>
        </div>
        <div class="form-check">
          <label class="form-check-label">
            <input type="checkbox" formControlName="evening" class="form-check-input">
            เย็น
          </label>
        </div>
        <div class="form-check">
          <label class="form-check-label">
            <input type="checkbox" formControlName="night" class="form-check-input">
            กลางคืน
          </label>
        </div>
      </div>
    </app-menu>
    <button *ngIf="canGoBack()" type="button" class="ml-auto btn btn-link" (click)="goBack()">
      ปิดการค้นหา
    </button>
  </form>
</ng-container>

<div class="container mt-5 mb-5" *ngIf="(searchResult | async) as result">
  <ng-container *ngIf="result.status === 'ok'; else noSearchQuery">
    <ng-container *ngIf="result?.markets.length > 0; else emptySearchResult">
      <div class="row" [@pageChangeAnim]="result.currentPage">
        <div class="col-12 col-sm-6 col-lg-3 mb-5" *ngFor="let market of result?.markets; trackBy: marketTrackByFn" @marketInOut>
          <app-market-item [market]="market"></app-market-item>
        </div>
      </div>

      <app-pagination class="mt-2" [current]="currentPage | async" [max]="result.totalPage" [padding]="3" (navigate)="goToSearchPage($event)"></app-pagination>
    </ng-container>

    <ng-template #emptySearchResult>
      <div class="empty-search-result">
        <h3>ไม่พบตลาดที่ตรงตามคำค้น</h3>
        <div class="no-result-suggestion">
          ลองเปลี่ยนการค้นหา หรือทำตามคำแนะด้านล่าง
          <ul>
            <li>ตรวจสอบชื่อตลาด หรือสถานที่ที่ต้องการค้นหา</li>
            <li>เปลี่ยนช่วงวันจัดตลาด</li>
            <li>เปลี่ยนตัวกรองผลการค้นหา หรือเอาตัวกรองผลการค้นหาบางอันออก</li>
          </ul>
          <button type="button" class="btn btn-primary my-2 my-sm-0" routerLink="#">เอาตัวกรองทั้งหมดออก</button>
        </div>
      </div>
    </ng-template>
  </ng-container>

  <ng-template #noSearchQuery>
    <div class="no-search-query" *ngIf="result.status === 'emptySearchParams'">
      <h3>กรุณากรอกคำค้นหา</h3>
      <div class="no-result-suggestion">
        คุณสามารถค้นหาตลาดได้ง่ายๆ จากการ
        <ul>
          <li>ระบุชื่อตลาด หรือสถานที่</li>
          <li>เลือกช่วงวันจัดตลาด</li>
          <li>เพิ่มตัวกรองต่างๆ เพื่อตัดตลาดที่ไม่ต้องการออกจากผลการค้นหา</li>
        </ul>
      </div>
    </div>
  </ng-template>
</div>